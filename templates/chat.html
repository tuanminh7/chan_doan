<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chatbot tư vấn bệnh cây</title>
  <style>
    *{box-sizing:border-box}body{margin:0;font-family:"Segoe UI",Tahoma,sans-serif;background:#f4f6f9;height:100vh;display:flex;flex-direction:column}
    .chat-header{background:#2e7d32;color:#fff;padding:14px 18px;display:flex;justify-content:space-between;align-items:center;font-size:18px;font-weight:600;flex-shrink:0}
    .chat-header a{background:#fff;color:#2e7d32;padding:6px 12px;border-radius:6px;text-decoration:none;font-size:14px;transition:.2s}
    .chat-header a:hover{background:#e8f5e9}
    .chat-box{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column}
    .message{display:flex;margin-bottom:12px}
    .message.user{justify-content:flex-end}
    .message.bot{justify-content:flex-start}
    .bubble{padding:12px 16px;border-radius:16px;max-width:80%;font-size:15px;line-height:1.4;word-wrap:break-word}
    .user .bubble{background:#2e7d32;color:#fff;border-bottom-right-radius:4px}
    .bot .bubble{background:#e9f5ec;color:#222;border-bottom-left-radius:4px}
    .chat-image{max-width:220px;border-radius:12px;border:2px solid #ddd}
    .chat-form{display:flex;align-items:center;padding:10px;background:#fff;border-top:1px solid #ddd;flex-shrink:0}
    .chat-form input[type="file"],.chat-form input[type="url"]{flex:1;padding:10px;border:1px solid #ccc;border-radius:20px;font-size:15px;outline:none}
    .file-label{background:#2e7d32;color:#fff;padding:8px 14px;margin:0 8px;border-radius:20px;cursor:pointer;font-size:14px}
    .chat-form button{background:#2e7d32;color:#fff;padding:10px 16px;border:none;border-radius:20px;cursor:pointer;font-size:15px;transition:.2s}
    .chat-form button:hover{background:#256628}
  </style>
</head>
<body>
  <div class="chat-header">
    <div>Chatbot tư vấn bệnh cây</div>
    <a href="{{ url_for('clear') }}">Xóa lịch sử</a>
  </div>

  <div id="chat-box" class="chat-box">
    {% for m in messages %}
      {% if m.type == 'image' %}
        <div class="message user">
          <div class="bubble">
            <img src="{{ url_for('static', filename=m.content) }}" class="chat-image">
          </div>
        </div>
      {% elif m.type == 'text' %}
        <div class="message bot">
          <div class="bubble">{{ m.content }}</div>
        </div>
      {% endif %}
    {% endfor %}
  </div>

  <form action="{{ url_for('send') }}" method="post" enctype="multipart/form-data" class="chat-form">
    <input id="file-upload" type="file" name="file" accept="image/*">
    <button type="submit">Tải ảnh</button>
  </form>

  <script>
    const chatBox=document.getElementById("chat-box");chatBox.scrollTop=chatBox.scrollHeight;
  </script>
</body>
</html>
